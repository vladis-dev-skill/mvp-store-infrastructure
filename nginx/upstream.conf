# Upstream configuration for fault-tolerant load balancing

upstream backend_upstream {
    # Backend service instances
    server mvp-store-backend:8080 max_fails=3 fail_timeout=30s weight=1;
    # Add more backend instances for HA:
    # server mvp-store-backend-2:8080 max_fails=3 fail_timeout=30s weight=1;

    # Load balancing method
    least_conn;

    # Keep alive connections for better performance
    keepalive 32;
}

upstream payment_upstream {
    # Payment service instances
    server mvp-store-payment:8080 max_fails=2 fail_timeout=20s weight=1;
    # Add more payment instances for HA:
    # server mvp-store-payment-2:8080 max_fails=2 fail_timeout=20s weight=1;

    # Load balancing method
    least_conn;

    # Keep alive connections
    keepalive 16;
}